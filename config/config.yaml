# =====================================================================
# Intelligent Demand Sensing & Autonomous Inventory Planning (IDS)
# =====================================================================

project:
  name: "Intelligent Demand Sensing & Autonomous Inventory Planning"
  short_name: "IDS"
  version: "1.0.0"
  environment: "local"
  timezone: "Asia/Kolkata"

# =====================================================================
# Paths Configuration
# =====================================================================
paths:
  data:
    raw: "data/raw"
    processed: "data/processed"
    external: "data/external"

  output:
    forecasts: "output/forecasts"
    inventory: "output/inventory"
    metrics: "output/metrics"
    plots: "output/plots"
    reports: "output/reports"
    model: "output/model"
    scenarios: "output/scenarios"

  logs: "logs"

# =====================================================================
# Logging & Reproducibility
# =====================================================================
logging:
  level: "INFO"
  log_to_file: true
  filename: "ids_project.log"

seeds:
  global_seed: 42
  propagate_to_models: true

# =====================================================================
# Data Schema & Column Normalization
# =====================================================================
data_schema:
  sales:
    date_column: "date"
    target_column: "total_sales"

    required_columns:
      - date
      - total_sales
      - sales_open
      - sales_closed

    optional_columns:
      - is_festival
      - is_holiday
      - is_promo
      - weekday_weekend
      - day

    optional_column_policy:
      on_missing: "warn"

    normalize_columns: true

    rename_map:
      date: ["date"]
      total_sales: ["total_sales", "sales", "total"]
      sales_open: ["sales_open", "open_sales"]
      sales_closed: ["sales_closed", "closed_sales"]

  calendar:
    date_column: "date"

    holiday_column: "is_holiday"
    festival_column: "is_festival"
    festival_name_column: "festival_name"

    required_columns:
      - date
      - is_festival
      - is_holiday

    optional_columns:
      - festival_name
      - day
      - weekday_weekend

    optional_column_policy:
      on_missing: "warn"

    normalize_columns: true

    rename_map:
      date: ["date"]
      is_festival: ["festival", "festival_flag", "is_festival"]
      is_holiday: ["holiday", "holiday_flag", "is_holiday"]
      festival_name: ["festival_name", "fest_name"]
      weekday_weekend: ["weekday_weekend", "week_type"]
      day: ["day", "weekday", "day_of_week"]

# =====================================================================
# Ingestion Configuration
# =====================================================================
ingestion:
  demand_source: "sales"
  header: true
  skip_rows: 0

  na_values:
    - ""
    - "NA"
    - "N/A"
    - "null"
    - "None"

  strict_load: true

  datasets:
    calendar:
      enabled: true
      source_type: csv
      file: "calendar_holidays.csv"
      csv:
        delimiter: ","
        encoding: "utf-8"

    sales:
      enabled: true
      source_type: excel
      file: "sales_data.xlsx"
      excel:
        sheet_name: "22-24"

# =====================================================================
# Data Cleaning
# =====================================================================
data_cleaning:
  sales:

    duplicate:
      unique_key: ["date"]
      strategy: "keep_first"

    critical_columns:
      - date
      - total_sales

    missing:
      numeric: "interpolate"
      categorical: "unknown"
      boolean: "mode"
      datetime: "none"

    per_column:
      total_sales: "ffill"

# =====================================================================
# Feature Engineering
# =====================================================================
features:
  time_features:
    enabled: true
    day_of_week: true
    is_weekend: true
    month: true
    quarter: true
    is_month_start: true
    is_month_end: true

  lag_features:
    enabled: true
    lags: [1, 7, 14, 30]

  rolling_features:
    enabled: true
    windows: [7, 14, 30]

  calendar_features:
    enabled: true

  aggregation_features:
    enabled: true
    same_weekday_window: 4

  include_promotions: false

  demand_bucketing:
    method: "quantile"
    labels: ["Low", "Medium", "High"]

# =====================================================================
# Modeling Configuration
# =====================================================================
modeling:

  train_test_split:
    method: "time"
    test_days: 90

  forecast_horizon_days: 365

  ranking:
    primary_metric: "MAPE (%)"
    higher_is_better: false

  models:
    linear_regression:
      enabled: true

    ridge:
      enabled: true

    random_forest:
      enabled: true
      params:
        n_estimators: 200
        max_depth: 10

    xgboost:
      enabled: true
      params:
        learning_rate: 0.1
        n_estimators: 150
        max_depth: 8

    lightgbm:
      enabled: true
      params:
        learning_rate: 0.05
        n_estimators: 200
        max_depth: -1
        verbosity: -1

    prophet:
      enabled: false
      yearly_seasonality: true
      weekly_seasonality: true

# =====================================================================
# Hyperparameter Tuning
# =====================================================================
hyperparameter_tuning:
  enabled: true
  tune_top_n: 3
  cv_splits: 5
  n_iter: 15

  ridge:
    alpha: [0.01, 0.1, 1, 10, 50, 100, 200]

  random_forest:
    n_estimators: [100, 200, 300]
    max_depth: [5, 10, 20]

  xgboost:
    learning_rate: [0.05, 0.1]
    max_depth: [6, 8]
    n_estimators: [100, 150, 200]

  lightgbm:
    learning_rate: [0.01, 0.05]
    max_depth: [-1, 10, 20]
    n_estimators: [100, 200]

# =====================================================================
# Ensemble Configuration
# =====================================================================
ensemble:
  method: "stacking"
  enabled: true
  top_k_models: 3
  meta_model: "ridge"

# =====================================================================
# Inventory (Required by Loader)
# =====================================================================
inventory:
  service_level: 0.95
  lead_time_days: 7
  demand_variability_method: "std"
  simulated_current_inventory: 500

# =====================================================================
# Forecasting (Required by Loader)
# =====================================================================
forecasting:
  enabled: true
  frequency: "D"
  start_date: "2025-03-23"
  end_date: "2025-12-15"

# =====================================================================
# LLM (Validator-Compliant)
# =====================================================================
llm:
  enabled: false
  storage_path: "output/scenarios/store/scenario_store.json"
  scenario_ttl_hours: 24

  session:
    enabled: true
    auto_create_session: true
    include_timestamp_in_filename: true

  output_structure:
    use_session_subfolders: true
    scenarios_subfolder: "scenarios"
    comparisons_subfolder: "comparisons"
    store_subfolder: "store"

  id_format:
    prefix: "SCN"
    include_timestamp: true
    counter_padding: 3

  runtime_control:
    allow_in_production: false
    allow_in_training: true
    allow_in_ci: false

  model_name: "gpt-4"
  provider: "openai"
  temperature: 0.2
  max_tokens: 500
  fallback_regex: true

  guardrails:
    max_demand_change_pct: 50
    max_lead_time_days: 90
    service_level_range:
      min: 0.80
      max: 0.99

  comparison:
    enabled: true
    recompute_inventory: true
    export_markdown: true

# =====================================================================
# SHAP (Phase 6 Governance)
# =====================================================================
shap:
  enabled: true
  sample_size: 500

# =====================================================================
# Execution Controls
# =====================================================================
execution:
  mode: "train"
  save_intermediate_outputs: true
  overwrite_existing_outputs: false

# =====================================================================
# Visualization
# =====================================================================
visualization:
  enabled: true
  skip_in_production: true